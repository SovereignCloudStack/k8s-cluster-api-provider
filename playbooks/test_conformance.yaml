---
- name: E2E conformance test
  hosts: all
  roles:
  - ensure-dependencies
  environment:
    ENVIRONMENT: "{{ cloud_provider }}"
  tasks:
  - name: Create k8s cluster and run check-conformance
    block:
    - name: Create environment file
      import_tasks: create_env_file.yaml
    - name: Create k8s cluster
      import_tasks: create.yaml
    - name: Execute sonobouy conformance check
      import_tasks: check.yaml
      vars:
        mode: conformance
    always:
    - name: Cleanup
      import_tasks: fullclean.yaml
